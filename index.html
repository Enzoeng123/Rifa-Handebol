<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rifa Handebol</title>
    <link rel="icon" href="galinhabg.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-remote-config-compat.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Estilos CSS (iguais ao anterior) */
        .font-bebas { font-family: 'Bebas Neue', sans-serif; }
        .font-roboto { font-family: 'Roboto', sans-serif; }
        .loading-spinner { border: 4px solid #f3f4f6; border-top: 4px solid #f97316; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .number-btn { transition: all 0.2s ease-in-out; }
        .number-btn:hover { transform: scale(1.1); z-index: 10; }
        .number-available { background-color: rgb(55 65 81); color: rgb(209 213 219); }
        .number-available:hover { background-color: rgb(75 85 99); }
        .number-reserved { background-color: rgb(234 179 8); color: rgb(0 0 0); box-shadow: 0 4px 6px -1px rgba(234, 179, 8, 0.5); }
        .number-reserved:hover { background-color: rgb(250 204 21); }
        .number-sold { background-color: rgb(185 28 28); color: rgb(255 255 255); box-shadow: 0 4px 6px -1px rgba(185, 28, 28, 0.5); }
        .number-sold:hover { background-color: rgb(220 38 38); }
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; padding: 1rem; z-index: 50; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .modal-overlay.show { opacity: 1; }
        .modal-content { background-color: rgb(31 41 55); border: 1px solid rgb(55 65 81); border-radius: 1rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); width: 100%; max-width: 24rem; margin: 0 auto; padding: 1.5rem; position: relative; transform: scale(0.95); transition: transform 0.3s ease-in-out; }
        .modal-overlay.show .modal-content { transform: scale(1); }
        .hidden { display: none !important; }
        .numbers-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 0.5rem; }
        @media (min-width: 640px) { .numbers-grid { grid-template-columns: repeat(14, 1fr); } }
    </style>
</head>
<body class="bg-gray-900">
    <div id="loading-screen" class="flex items-center justify-center min-h-screen bg-gray-900 text-white">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-xl font-light">Carregando Rifa Handebol...</p>
        </div>
    </div>
    <div id="error-screen" class="hidden text-red-400 text-center p-4 bg-gray-900 min-h-screen">
         <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <h2 class="text-2xl font-bold mb-4">Erro Crítico</h2>
                <p id="error-message" class="text-lg"></p>
                <p class="mt-4 text-sm text-gray-400">Entre em contato com o suporte técnico.</p>
            </div>
        </div>
    </div>
    <div id="main-app" class="hidden bg-gradient-to-br from-gray-900 via-red-900 to-black min-h-screen font-roboto p-4 sm:p-6 lg:p-8 text-white">
        <div class="max-w-5xl mx-auto">
            <header class="text-center mb-6">
                <h1 class="font-bebas text-6xl md:text-7xl font-bold text-orange-400 tracking-wider">Rifa Handebol</h1>
                <p class="text-gray-300">Atlética Embrasada</p>
                <div class="mt-6 bg-gray-800 bg-opacity-40 border-l-4 border-orange-500 text-gray-200 p-4 rounded-md text-left max-w-2xl mx-auto shadow-lg">
                    <p class="font-bold mb-2 text-orange-400">Instruções:</p>
                    <ol class="list-decimal list-inside space-y-2 text-gray-300">
                        <li>Selecione o número desejado;</li>
                        <li>Coloque seu nome e número para contato;</li>
                        <li>Marque o número como reservado;</li>
                        <li>Realize o pagamento na chave Pix: <strong class="text-orange-400">75982480821</strong> (Maria Eduarda Fernandes de Almeida);
                             <ul class="list-disc list-inside pl-5 pt-1"><li>Cada bilhete custa R$5,00;</li></ul>
                        </li>
                        <li>Envie o comprovante para o contato da Atlética: <strong class="text-orange-400">(75) 9.8112-2771</strong>;</li>
                        <li>Selecione seu número novamente e marque como vendido;</li>
                    </ol>
                    <ul class="list-disc list-inside space-y-2 text-gray-300 mt-3">
                        <li>O sorteio será realizado no dia 15 de agosto no nosso Instagram <strong class="text-orange-400">@atleticamedicinaunef</strong>;</li>
                        <li>O prêmio é R$100,00 no Pix do vencedor;</li>
                        <li>Caso deseje desistir de algum número, entre em contato com a atlética para que possamos liberar o número.</li>
                    </ul>
                </div>
            </header>
            <div class="mb-6 p-4 bg-gray-900 bg-opacity-60 rounded-xl shadow-lg">
                <div class="flex flex-wrap justify-center items-center gap-4 sm:gap-8">
                    <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-red-700"></div><span class="text-gray-300">Vendido (<span id="sold-count">0</span>)</span></div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-yellow-500"></div><span class="text-gray-300">Reservado (<span id="reserved-count">0</span>)</span></div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-gray-700"></div><span class="text-gray-300">Disponível (<span id="available-count">140</span>)</span></div>
                </div>
            </div>
            <main class="numbers-grid p-4 bg-gray-900 bg-opacity-50 rounded-xl shadow-2xl" id="numbers-grid"></main>
            <footer class="text-center mt-8 text-gray-500 text-sm">
                <p><strong class="text-lime-500">Suporte técnico: (75) 9.9176-1914</strong></p>
                <p><strong class="text-lime-500">©Feito por: @enzo.sprr</strong></p>
            </footer>
        </div>
    </div>
    <div id="number-modal" class="modal-overlay hidden">
        </div>
    <div id="generated-text-modal" class="modal-overlay hidden" style="z-index: 60;">
        </div>
    <script>
        // === CONFIGURAÇÃO FIREBASE (ESPECÍFICA DESTA RIFA) ===
        const firebaseConfig = {
            apiKey: "AIzaSyAaq6Axgk7LGZlO0j_WWLoG6QRUIetj9dk",
            authDomain: "rifa-handebol-embrasada.firebaseapp.com",
            projectId: "rifa-handebol-embrasada",
            storageBucket: "rifa-handebol-embrasada.firebasestorage.app",
            messagingSenderId: "184640580884",
            appId: "1:184640580884:web:f91ca340d06e46cf82a601"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = app.firestore();
        const auth = app.auth();
        const remoteConfig = app.remoteConfig();

        // === ESTADO DA APLICAÇÃO (ESPECÍFICO DESTA RIFA) ===
        const AppState = {
            isAuthReady: false,
            numbers: [],
            selectedNumber: null,
            isLoading: true,
            error: "",
            raffleId: "rifa-embrasada-2025-handebol", // ID fixo e oculto
            // ... (resto do estado é igual ao anterior)
        };

        const Elements = { /* ... (igual ao anterior) */ };

        // === FUNÇÕES (A MAIORIA É IGUAL AO ANTERIOR) ===
        
        function updateStats() {
            const stats = AppState.numbers.reduce((acc, number) => {
                acc[number.status] = (acc[number.status] || 0) + 1;
                return acc;
            }, { sold: 0, reserved: 0, available: 0 });
            
            stats.available = 140 - (stats.sold + stats.reserved); // <-- AQUI MUDA PARA 140
            
            Elements.soldCount.textContent = stats.sold;
            Elements.reservedCount.textContent = stats.reserved;
            Elements.availableCount.textContent = stats.available;
        }

        function setupFirestoreListener() {
            if (!AppState.isAuthReady || !AppState.raffleId) return;
            
            const raffleDocRef = db.collection("rifas").doc(AppState.raffleId);
            
            AppState.unsubscribeFirestore = raffleDocRef.onSnapshot(docSnap => {
                // A verificação agora é para 140 números
                if (docSnap.exists && docSnap.data().numbers && docSnap.data().numbers.length === 140) {
                    AppState.numbers = docSnap.data().numbers;
                    renderNumbers();
                    updateStats();
                    hideLoading();
                } else {
                    // **NÃO INICIALIZA MAIS A RIFA**
                    console.error("Documento da rifa não encontrado ou corrompido. ID:", AppState.raffleId);
                    showError("Os dados da rifa não foram encontrados ou estão corrompidos. A inicialização automática foi desativada para prevenir perda de dados.");
                }
            }, err => {
                console.error("Firestore Snapshot Error:", err);
                showError("Não foi possível carregar os dados da rifa. Verifique sua conexão e as regras de segurança do Firestore.");
            });
        }

        // O resto do JavaScript (funções de salvar, limpar, etc.) é idêntico ao da outra rifa
        // ... (cole aqui o resto do JavaScript do arquivo anterior)
        
        function initializeApp() {
            setupEventListeners();
            auth.onAuthStateChanged(async (user) => {
                if (!user) await auth.signInAnonymously();
                AppState.isAuthReady = true;
                setupFirestoreListener();
            });
        }
        
        // Cole as demais funções JS aqui (sem alterações)

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
